<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Audio Demo</title>
    <link rel="stylesheet" href="upload/bootstrap.css">
    <link rel="stylesheet" href="user-infinity.css">
    <style>
#myCanvas
{
    pointer-events: none;       /* make the canvas transparent to the mouse - needed since canvas is position infront of image */
    position:absolute;
    z-index: 2;
}


    </style>
    <script>
        function dummy(){console.log("dummy");}
    </script>
    <script type="text/javascript" src="howler/howler.js/dist/howler.js"></script>
    <script type="text/javascript" src="user-infinity.js"></script>
    <script>

        var queue;
        var started = false;

        function player () {
            var dur = active.duration();
            active.play();
            var waittime = rrand(dur/5, dur*5);
            if ((dur > 5) || (rrand(0, 13) < 5)){
                active = queue.shift();
            };
            setTimeout(player, dur*1000);
        }
        
        function loadaudio() {
            console.log("doplay");
            
            loadJSON('json/8.json',
                function(audio_files) { //console.log(audio_files); 
                    
                    var chosen = getNRandSorted(audio_files, 5);
                    //var sounds = [];
                    var howl;
                    var queue = [];
                    
                    chosen.forEach(element => {
                        howl = new Howl ({ src: "processed_audio/" + [element[2] + "/" + element[4]], preload: true });
                        howl.on("load", function () {
                            queue.push(howl);
                            if (! started){
                                started = true;
                                var active = queue.shift
                                player();
                            }
                        });
                    });
                    
                    var sleeptime = 20;
                    sounds.forEach(element =>{
                        await sleep(sleeptime);
                        //element.play();
                        sleeptime = rrand(200, 3000);
                    })
                    
                }, 
                function(xhr) { console.error(xhr); }
            );
            
        }
        
        function play_stuff(){
            loadaudio().then(
                function(value) { console.log("playing"); },
                function(error) { /* code if some error */ }
            );
        }

        
    </script>
</head>
<body  onload="loadaudio();">
    <div class="page-header">
        <h1>Audio Demo</h1>
    </div>
</body>
</html>